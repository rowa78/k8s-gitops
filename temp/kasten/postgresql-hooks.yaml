apiVersion: cr.kanister.io/v1alpha1
kind: Blueprint
metadata:
  name: eve-postgresql-hooks
actions:
  backupPrehook:
    phases:
    - func: KubeExec
      name: makePGCheckPoint
      args:
        namespace: "eve-dev"
        pod: "rwcloud-eve-dev-db-0"
        container: postgresql
        command:
        - bash
        - -o
        - errexit
        - -o
        - pipefail
        - -c
        - |          
          PGPASSWORD=${PGPASSWORD_SUPERUSER} psql -U $PGUSER_SUPERUSER -c "select pg_start_backup('app_cons');"
  backupPosthook:
    phases:
    - func: KubeExec
      name: afterPGBackup
      args:
        namespace: "eve-dev"
        pod: "rwcloud-eve-dev-db-0"
        container: postgresql
        command:
        - bash
        - -o
        - errexit
        - -o
        - pipefail
        - -c
        - |
          PGPASSWORD=${PGPASSWORD_SUPERUSER} psql -U $PGUSER_SUPERUSER -c "select pg_stop_backup();"