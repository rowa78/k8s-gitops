# Open Notebook - connects to externally deployed SurrealDB

nameOverride: ""
fullnameOverride: ""

openNotebook:
  image:
    repository: lfnovo/open_notebook
    tag: 1.6.2
    pullPolicy: Always

  replicaCount: 1

  # External SurrealDB connection (SurrealDB deployed separately via surrealdb/helm-charts)
  surrealdb:
    url: ws://open-notebook-surrealdb:8000/rpc    
    namespace: open_notebook
    database: open_notebook

  # API URL für Web-Frontend (wenn API per Ingress auf separatem Host erreichbar)
  # z.B. https://api.notebook.rwcloud.org - Frontend ruft dann diese URL für API-Calls auf
  apiUrl: "https://api.notebook.rwcloud.org"

  # Use existing secret for SurrealDB credentials (overrides surrealdb.user/password above)
  surrealdbExistingSecret:
    name: surrealdb-credentials
    userKey: SURREAL_USER
    passKey: SURREAL_PASS

  # Encryption key for credential storage (REQUIRED - Pod won't start without it)
  # Option A: Set existingSecret.name to use an existing Secret
  # Option B: Set sealedSecret.encryptedData (run kubeseal, paste the base64 value)
  encryptionKey:
    existingSecret:
      # When set, use this secret instead of creating SealedSecret
      name: open-notebook-secret
      key: OPEN_NOTEBOOK_ENCRYPTION_KEY
    sealedSecret:
      # Base64 encrypted value from: echo -n "your-key" | kubectl create secret generic open-notebook-secrets --from-file=OPEN_NOTEBOOK_ENCRYPTION_KEY=/dev/stdin -n open-notebook --dry-run=client -o yaml | kubeseal -n open-notebook -o yaml
      encryptedData: ""

  passwordKey:
    existingSecret:
      name: open-notebook-secret
      key: OPEN_NOTEBOOK_PASSWORD

  persistence:
    enabled: true
    size: 2Gi
    storageClass: openebs-hostpath

  resources: {}

ingress:
  enabled: true
  className: traefik
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-production
    gethomepage.dev/enabled: "true"
    gethomepage.dev/description: Open Notebook
    gethomepage.dev/group: Apps
    gethomepage.dev/name: Open Notebook
    gethomepage.dev/pod-selector: "app.kubernetes.io/name=open-notebook"
  hosts:
    - host: notebook.rwcloud.org
      paths:
        - path: /
          pathType: Prefix
          servicePort: 8502  # Web UI
  # API auf separatem Subdomain (z.B. api.notebook.rwcloud.org)
  api:
    enabled: true
    host: api.notebook.rwcloud.org
    path: /
    pathType: Prefix
    servicePort: 5055
  tls:
    - secretName: open-notebook-tls
      hosts:
        - notebook.rwcloud.org
    - secretName: open-notebook-api-tls
      hosts:
        - api.notebook.rwcloud.org
  